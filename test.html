<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SHRI â€” My Account</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #fff8f0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    /* Sticky Navbar */
    .navbar {
      background: linear-gradient(to right, #ff512f, #f09819);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .navbar-brand img {
      height: 50px;
    }
    .navbar-nav .nav-link {
      color: white !important;
      margin: 0 10px;
      font-weight: 500;
    }
    /* Main content flex */
    main {
      flex: 1;
      padding: 20px;
    }
    /* Login box */
    .login-container {
      max-width: 400px;
      margin: 60px auto;
      padding: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .login-container h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #ff512f;
    }
    /* Summary cards */
    .summary {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .summary .card {
      flex: 1 1 200px;
      text-align: center;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .summary .card h3 {
      margin: 10px 0;
      color: #ff512f;
    }
    /* Detail table */
    table {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    th, td {
      text-align: center !important;
    }
    /* Footer always at bottom */
    footer {
      background: linear-gradient(to right, #ff512f, #f09819);
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: auto;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <a class="navbar-brand" href="index.html">
      <img src="images/shriapp.png" alt="SHRI Logo">
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="services.html">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        <li class="nav-item"><a class="nav-link" href="privacy.html">Privacy Policy</a></li>
        <li class="nav-item"><a class="nav-link active" href="myaccount.html">My Account</a></li>
      </ul>
    </div>
  </div>
</nav>

<main>
  <!-- Login Form -->
  <div class="login-container" id="loginBox">
    <h2>My Account</h2>
    <form id="loginForm">
      <div class="mb-3">
        <label for="username" class="form-label">Username</label>
        <input type="text" id="username" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-warning w-100">Login</button>
    </form>
  </div>

  <!-- User Dashboard -->
  <div id="dashboard" class="d-none">
    <!-- Summary -->
    <div class="summary mb-4">
      <div class="card p-3">
        <h5>Pali (Shifts)</h5>
        <h3 id="totalShifts">0</h3>
      </div>
      <div class="card p-3">
        <h5>Upad</h5>
        <h3 id="totalUpad">0</h3>
      </div>
      <div class="card p-3">
        <h5>Balance</h5>
        <h3 id="totalBalance">0</h3>
      </div>
    </div>

    <!-- Details Table -->
    <div class="table-responsive">
      <table class="table table-striped" id="detailsTable">
        <thead class="table-warning">
          <tr>
            <th>Date</th>
            <th>Shift</th>
            <th>Customer</th>
            <th>Detail</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <button class="btn btn-danger w-100 mt-3" id="logoutBtn">Logout</button>
  </div>
</main>

<footer>
  <div class="container">
    <p>&copy; 2025 SHRI. All Rights Reserved.</p>
  </div>
</footer>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiY6KxBt8D56NqbxolsprymBXiJcMeUuvQ7y5J1NKsevUqPXQXJFBJHeJ1tDqJ2_gWYM7hc23Mgy_k/pub?output=csv";

const loginBox = document.getElementById("loginBox");
const dashboard = document.getElementById("dashboard");
const logoutBtn = document.getElementById("logoutBtn");
const totalShiftsEl = document.getElementById("totalShifts");
const totalUpadEl = document.getElementById("totalUpad");
const totalBalanceEl = document.getElementById("totalBalance");
const detailsTableBody = document.querySelector("#detailsTable tbody");

let csvData = [];

function parseCSV(text) {
  const rows = text.trim().split("\n");
  return rows.map(r => r.split(","));
}

// Fetch CSV data
fetch(sheetUrl)
  .then(resp => resp.text())
  .then(text => {
    csvData = parseCSV(text);
  });

document.getElementById("loginForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  const headers = csvData[0];
  const rows = csvData.slice(1);

  // Find user
  const userRow = rows.find(r => r[0] === username && r[1] === password);
  if(!userRow) return alert("Username or password incorrect!");

  const role = userRow[2];
  const userName = userRow[3];
  const rate = parseFloat(userRow[4]);

  // Filter data for this user or for seniors (if role=senior, show others too)
  let userData;
  if(role === "employee") {
    userData = rows.filter(r => r[3] === userName); // show only employee's own rows
  } else if(role === "senior") {
    userData = rows.filter(r => r[2] === "employee"); // show all employees
  } else if(role === "customer") {
    userData = rows.filter(r => r[0] === username); // customer's own rows
  }

  // Calculate summary
  let totalShifts = 0, totalUpad = 0, totalBalance = 0;
  detailsTableBody.innerHTML = "";

  userData.forEach(r => {
    const date = r[8];
    const morning = parseInt(r[9]) || 0;
    const evening = parseInt(r[10]) || 0;
    const night = parseInt(r[11]) || 0;
    const customer = r[12];
    const detail = r[13];
    const amount = parseFloat(r[14]) || 0;

    const shiftCount = morning + evening + night;
    totalShifts += shiftCount;
    totalUpad += amount;
    totalBalance += shiftCount * rate - amount;

    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${date}</td><td>${shiftCount}</td><td>${customer}</td><td>${detail}</td><td>${amount}</td>`;
    detailsTableBody.appendChild(tr);
  });

  totalShiftsEl.textContent = totalShifts;
  totalUpadEl.textContent = totalUpad;
  totalBalanceEl.textContent = totalBalance;

  loginBox.classList.add("d-none");
  dashboard.classList.remove("d-none");
});

logoutBtn.addEventListener("click", () => {
  dashboard.classList.add("d-none");
  loginBox.classList.remove("d-none");
  document.getElementById("loginForm").reset();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
