<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Account — SHRI</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #fff8f0;
    }

    /* Navbar */
    .navbar {
      background: linear-gradient(to right, #ff512f, #f09819);
    }
    .navbar-brand img {
      height: 40px;
    }
    .navbar-nav .nav-link {
      color: white !important;
      font-weight: 500;
    }

    /* Login Box */
    .login-container {
      max-width: 400px;
      margin: 80px auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
      padding: 25px;
    }
    .login-container h2 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: bold;
      color: #ff512f;
    }
    .btn-theme {
      background: linear-gradient(to right, #ff512f, #f09819);
      border: none;
      color: #fff;
      font-weight: 500;
    }
    .btn-theme:hover {
      opacity: 0.9;
    }

    /* Summary Cards */
    .summary-card {
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: center;
      margin-bottom: 15px;
      background: #fff;
    }
    .summary-card h5 {
      color: #ff512f;
      font-weight: bold;
    }

    /* Footer */
    footer {
      background: linear-gradient(to right, #ff512f, #f09819);
      color: white;
      text-align: center;
      padding: 12px;
      position: fixed;
      bottom: 0;
      width: 100%;
    }

    /* Responsive Table */
    .table-responsive {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <a class="navbar-brand" href="index.html">
      <img src="images/shriapp.png" alt="SHRI Logo">
    </a>
    <div class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="services.html">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        <li class="nav-item"><a class="nav-link" href="privacy.html">Privacy</a></li>
        <li class="nav-item"><a class="nav-link active" href="myaccount.html">My Account</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Login Form -->
<div class="container" id="loginSection">
  <div class="login-container">
    <h2>Login</h2>
    <form id="loginForm">
      <div class="mb-3">
        <label for="username" class="form-label">Username</label>
        <input type="text" id="username" class="form-control" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <input type="password" id="password" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-theme w-100">Login</button>
    </form>
  </div>
</div>

<!-- Account Section -->
<div class="container mt-4 d-none" id="accountSection">
  <div class="row">
    <div class="col-md-4 col-12">
      <div class="summary-card">
        <h5>Pali (Shifts)</h5>
        <p id="totalShifts">0</p>
      </div>
    </div>
    <div class="col-md-4 col-12">
      <div class="summary-card">
        <h5>Upad</h5>
        <p id="totalUpad">₹0</p>
      </div>
    </div>
    <div class="col-md-4 col-12">
      <div class="summary-card">
        <h5>Balance</h5>
        <p id="balance">₹0</p>
      </div>
    </div>
  </div>

  <!-- Details Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-warning">
        <tr>
          <th>Date</th>
          <th>Shift</th>
          <th>Customer</th>
          <th>Detail</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody id="detailsTable"></tbody>
    </table>
  </div>
</div>

<!-- Footer -->
<footer>
  <p>&copy; 2025 SHRI. All Rights Reserved.</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const registrationCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiY6KxBt8D56NqbxolsprymBXiJcMeUuvQ7y5J1NKsevUqPXQXJFBJHeJ1tDqJ2_gWYM7hc23Mgy_k/pub?gid=0&single=true&output=csv";
const dailyInputCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiY6KxBt8D56NqbxolsprymBXiJcMeUuvQ7y5J1NKsevUqPXQXJFBJHeJ1tDqJ2_gWYM7hc23Mgy_k/pub?gid=123456&single=true&output=csv"; // replace gid with dailyinput tab gid

let users = [];
let dailyData = [];

function loadData() {
  Papa.parse(registrationCSV, {
    download: true,
    header: true,
    complete: function(results) {
      users = results.data;
    }
  });
  Papa.parse(dailyInputCSV, {
    download: true,
    header: true,
    complete: function(results) {
      dailyData = results.data;
    }
  });
}
loadData();

// Handle login
document.getElementById("loginForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  const user = users.find(u => u.Username === username && u.Password === password);
  if (!user) {
    alert("Incorrect Username or Password");
    return;
  }

  document.getElementById("loginSection").classList.add("d-none");
  document.getElementById("accountSection").classList.remove("d-none");

  loadAccount(user);
});

// Build account
function loadAccount(user) {
  let shifts = 0, upad = 0, balance = 0;
  let rate = parseFloat(user.Rate || 0);
  const tableBody = document.getElementById("detailsTable");
  tableBody.innerHTML = "";

  dailyData.filter(row => row["Employee Username"] === user.Username).forEach(row => {
    let shiftCount = 0;
    if (row.Morning) shiftCount++;
    if (row.Evening) shiftCount++;
    if (row.Night) shiftCount++;
    shifts += shiftCount;

    let amt = parseFloat(row.Amount || 0);
    if (!isNaN(amt)) {
      upad += amt;
    }

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.Date}</td>
      <td>${row.Morning ? "Morning " : ""}${row.Evening ? "Evening " : ""}${row.Night ? "Night" : ""}</td>
      <td>${row.Customer}</td>
      <td>${row.Detail}</td>
      <td>₹${amt || 0}</td>
    `;
    tableBody.appendChild(tr);
  });

  balance = (shifts * rate) - upad;
  document.getElementById("totalShifts").innerText = shifts;
  document.getElementById("totalUpad").innerText = "₹" + upad;
  document.getElementById("balance").innerText = "₹" + balance;
}
</script>
</body>
</html>
