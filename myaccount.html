<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Account</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #6a1b9a;
      color: white;
      padding: 15px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    footer {
      background: #6a1b9a;
      color: white;
      padding: 10px;
      text-align: center;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    .container {
      max-width: 900px;
      margin: 80px auto 60px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    h2 { color: #6a1b9a; }
    .summary {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      text-align: center;
    }
    .summary div {
      flex: 1;
      padding: 10px;
      background: #f0e6f7;
      margin: 5px;
      border-radius: 6px;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #eee;
    }
    #loginForm {
      text-align: center;
      margin-top: 50px;
    }
    #loginForm input {
      padding: 8px;
      margin: 5px;
    }
    #logoutBtn {
      background: #d32f2f;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <header>
    <h1>My Account</h1>
  </header>

  <div class="container" id="loginSection">
    <h2>Login</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Username" required><br>
      <input type="password" id="password" placeholder="Password" required><br>
      <button type="submit">Login</button>
    </form>
  </div>

  <div class="container" id="accountSection" style="display:none;">
    <h2>Welcome, <span id="displayName"></span> (<span id="displayRole"></span>)</h2>
    <button id="logoutBtn">Logout</button>

    <div class="summary">
      <div>Pali (Shifts): <span id="paliCount">0</span></div>
      <div>Upad: ₹<span id="upadTotal">0</span></div>
      <div>Balance: ₹<span id="balanceTotal">0</span></div>
    </div>

    <h3>Details</h3>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Shift</th>
          <th>Customer</th>
          <th>Detail</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody id="detailsBody"></tbody>
    </table>
  </div>

  <footer>
    © Shri Website
  </footer>

  <script>
    const registrationUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiY6KxBt8D56NqbxolsprymBXiJcMeUuvQ7y5J1NKsevUqPXQXJFBJHeJ1tDqJ2_gWYM7hc23Mgy_k/pub?gid=0&single=true&output=csv";
    const dailyInputUrl   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiY6KxBt8D56NqbxolsprymBXiJcMeUuvQ7y5J1NKsevUqPXQXJFBJHeJ1tDqJ2_gWYM7hc23Mgy_k/pub?gid=123456789&single=true&output=csv"; // replace gid with actual Dailyinput tab gid

    let users = [];
    let dailyInputs = [];

    async function loadCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      return text.split("\n").map(row => row.split(","));
    }

    async function init() {
      const regData = await loadCSV(registrationUrl);
      const dailyData = await loadCSV(dailyInputUrl);

      const headersReg = regData[0];
      users = regData.slice(1).map(row => {
        let obj = {};
        headersReg.forEach((h,i) => obj[h.trim()] = row[i] ? row[i].trim() : "");
        return obj;
      });

      const headersDaily = dailyData[0];
      dailyInputs = dailyData.slice(1).map(row => {
        let obj = {};
        headersDaily.forEach((h,i) => obj[h.trim()] = row[i] ? row[i].trim() : "");
        return obj;
      });
    }

    document.getElementById("loginForm").addEventListener("submit", e => {
      e.preventDefault();
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      const user = users.find(u => u.Username === username && u.Password === password);
      if (!user) {
        alert("Invalid username or password");
        return;
      }

      document.getElementById("loginSection").style.display = "none";
      document.getElementById("accountSection").style.display = "block";
      document.getElementById("displayName").textContent = user.Name;
      document.getElementById("displayRole").textContent = user.Role;

      showUserData(user);
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
      document.getElementById("loginSection").style.display = "block";
      document.getElementById("accountSection").style.display = "none";
    });

    function showUserData(user) {
      let filtered = [];
      if (user.Role === "Employee") {
        filtered = dailyInputs.filter(d => d["Employee Username"] === user.Username);
      } else if (user.Role === "Senior") {
        filtered = dailyInputs; // senior sees all
      } else if (user.Role === "Customer") {
        filtered = dailyInputs.filter(d => d["Customer"] === user.Name);
      }

      // Calculate summary
      let paliCount = 0, upadTotal = 0, balance = 0;
      const rate = parseFloat(user.Rate || 0);

      filtered.forEach(d => {
        if (d.Morning) paliCount++;
        if (d.Evening) paliCount++;
        if (d.Night) paliCount++;
        if (d.Amount) upadTotal += parseFloat(d.Amount || 0);
      });

      balance = paliCount * rate - upadTotal;

      document.getElementById("paliCount").textContent = paliCount;
      document.getElementById("upadTotal").textContent = upadTotal.toFixed(2);
      document.getElementById("balanceTotal").textContent = balance.toFixed(2);

      // Fill details
      const tbody = document.getElementById("detailsBody");
      tbody.innerHTML = "";
      filtered.forEach(d => {
        const shifts = [];
        if (d.Morning) shifts.push("Morning");
        if (d.Evening) shifts.push("Evening");
        if (d.Night) shifts.push("Night");

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${d.Date}</td>
          <td>${shifts.join(", ")}</td>
          <td>${d.Customer}</td>
          <td>${d.Detail}</td>
          <td>${d.Amount || "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    init();
  </script>

</body>
</html>
