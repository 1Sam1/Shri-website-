<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Account</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; }
    header, footer { background:#333; color:white; text-align:center; padding:10px; position:sticky; top:0; }
    footer { position:fixed; bottom:0; width:100%; }
    .container { padding:20px; margin-bottom:60px; }
    .hidden { display:none; }
    .summary { display:flex; gap:20px; margin-bottom:20px; }
    .summary div { flex:1; background:#f4f4f4; padding:15px; border-radius:5px; text-align:center; }
    table { width:100%; border-collapse:collapse; margin-bottom:40px; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    th { background:#eee; }
    .login-box { max-width:300px; margin:50px auto; padding:20px; border:1px solid #ccc; border-radius:5px; }
    .login-box input { width:100%; padding:8px; margin:5px 0; }
    .login-box button { width:100%; padding:10px; background:#333; color:white; border:none; cursor:pointer; }
    select { padding:8px; margin-bottom:20px; }
  </style>
</head>
<body>

<header>
  <h1>My Account</h1>
</header>

<div class="container">
  <!-- Login Form -->
  <div id="login-section" class="login-box">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <!-- Employee/Senior Dashboard -->
  <div id="dashboard" class="hidden">
    <h2 id="welcome"></h2>
    <div id="senior-select" class="hidden">
      <label for="employeeSelect">View Employee: </label>
      <select id="employeeSelect" onchange="renderDashboard(this.value)"></select>
    </div>
    <div class="summary">
      <div><h3>Pali</h3><p id="pali">0</p></div>
      <div><h3>Upad</h3><p id="upad">0</p></div>
      <div><h3>Balance</h3><p id="balance">0</p></div>
    </div>
    <h3>Details</h3>
    <table id="detail-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Shift</th>
          <th>Customer</th>
          <th>Detail</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Customer Dashboard -->
  <div id="customer-dashboard" class="hidden">
    <h2 id="welcome-customer"></h2>
    <div class="summary">
      <div><h3>Total Shifts</h3><p id="cust-shifts">0</p></div>
      <div><h3>Total Amount</h3><p id="cust-amount">0</p></div>
    </div>
    <h3>Bill Details</h3>
    <table id="customer-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Employee</th>
          <th>Shift</th>
          <th>Detail</th>
          <th>Rate</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<footer>
  <p>&copy; 2025 Shri Website</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
<script>
const registrationCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiY6KxBt8D56NqbxolsprymBXiJcMeUuvQ7y5J1NKsevUqPXQXJFBJHeJ1tDqJ2_gWYM7hc23Mgy_k/pub?gid=0&single=true&output=csv";
const dailyInputCSV   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTiY6KxBt8D56NqbxolsprymBXiJcMeUuvQ7y5J1NKsevUqPXQXJFBJHeJ1tDqJ2_gWYM7hc23Mgy_k/pub?gid=123456789&single=true&output=csv"; 
// ⚠️ Replace gid=123456789 with actual GID of Dailyinput tab

let users = [];
let dailyData = [];
let currentUser = null;

async function loadCSV(url) {
  const res = await fetch(url);
  const text = await res.text();
  return Papa.parse(text, { header: true }).data;
}

async function init() {
  users = await loadCSV(registrationCSV);
  dailyData = await loadCSV(dailyInputCSV);
}
init();

function login() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  currentUser = users.find(u => u.Username === username && u.Password === password);

  if (!currentUser) {
    alert("Incorrect Username or Password");
    return;
  }

  document.getElementById("login-section").classList.add("hidden");

  if (currentUser.Role === "Employee") {
    document.getElementById("dashboard").classList.remove("hidden");
    document.getElementById("welcome").innerText = "Welcome, " + currentUser.Name;
    renderDashboard(username);

  } else if (currentUser.Role === "Senior") {
    document.getElementById("dashboard").classList.remove("hidden");
    document.getElementById("welcome").innerText = "Welcome Senior, " + currentUser.Name;
    document.getElementById("senior-select").classList.remove("hidden");

    // Fill dropdown with employees
    const employeeSelect = document.getElementById("employeeSelect");
    employeeSelect.innerHTML = "";
    users.filter(u => u.Role === "Employee").forEach(emp => {
      const opt = document.createElement("option");
      opt.value = emp.Username;
      opt.textContent = emp.Name;
      employeeSelect.appendChild(opt);
    });

    renderDashboard(employeeSelect.value);

  } else if (currentUser.Role === "Customer") {
    document.getElementById("customer-dashboard").classList.remove("hidden");
    document.getElementById("welcome-customer").innerText = "Welcome, " + currentUser.Name;
    renderCustomerBill(currentUser.Username);
  }
}

function renderDashboard(username) {
  const user = users.find(u => u.Username === username);
  const employeeData = dailyData.filter(row => row["Employee Username"] === username);

  let pali = 0, upad = 0;
  const tbody = document.querySelector("#detail-table tbody");
  tbody.innerHTML = "";

  employeeData.forEach(row => {
    ["Morning","Evening","Night"].forEach(shift => {
      if (row[shift] && row[shift].trim() !== "") {
        pali++;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.Date}</td>
          <td>${shift}</td>
          <td>${row.Customer}</td>
          <td>${row.Detail}</td>
          <td>${row.Amount || ""}</td>
        `;
        tbody.appendChild(tr);
      }
    });
    if (row.Amount) {
      upad += parseFloat(row.Amount) || 0;
    }
  });

  const rate = parseFloat(user.Rate) || 0;
  const balance = (pali * rate) - upad;

  document.getElementById("pali").innerText = pali;
  document.getElementById("upad").innerText = upad;
  document.getElementById("balance").innerText = balance;
}

function renderCustomerBill(customerUsername) {
  const tbody = document.querySelector("#customer-table tbody");
  tbody.innerHTML = "";
  let totalShifts = 0, totalAmount = 0;

  dailyData.forEach(row => {
    if (row.Customer === customerUsername) {
      const emp = users.find(u => u.Username === row["Employee Username"]);
      const rate = emp ? parseFloat(emp.Rate) || 0 : 0;

      ["Morning","Evening","Night"].forEach(shift => {
        if (row[shift] && row[shift].trim() !== "") {
          totalShifts++;
          totalAmount += rate;

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.Date}</td>
            <td>${emp ? emp.Name : row["Employee Username"]}</td>
            <td>${shift}</td>
            <td>${row.Detail}</td>
            <td>${rate}</td>
            <td>${rate}</td>
          `;
          tbody.appendChild(tr);
        }
      });
    }
  });

  document.getElementById("cust-shifts").innerText = totalShifts;
  document.getElementById("cust-amount").innerText = totalAmount;
}
</script>

</body>
</html>
